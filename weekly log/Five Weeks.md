# **5주차 ( 05/16 ~ 05/20 )**

## **주요 내용** 
  - 모델 학습용 데이터 수집, 데이터 정제, StarGAN 모델 학습 


<br/>



----------
## **데이터**
### &nbsp;&nbsp; 데이터 수집부터 전처리까지
- 데이터 수집 및 1차 검수   
  → 코드로 웹 크롤링 후, 불필요한 이미지 선별 후 드라이브 업로드
- 수집 시 사용 할 검색어와 사용 한 검색어 따로 관리. (중복 검색 방지)
- 전처리 및 2차 검수   
  → 업로드 된 이미지 crop 코드 돌린 후, 불필요한 이미지 선별
- 최종 검수 → 3차 검수에서 선별한 이미지를 한번 더 검수


### &nbsp;&nbsp; 1,2차 검수 시 제외하는 데이터 기준
- 미러링이 심하게 된 경우
- 제품 사진이 들어간 경우
- 얼굴 옆에 머리카락이나 살이 생성된 경우
- 윙크, 눈을 감은 경우
- 앞머리가 눈을 덮은 경우
- 머리 위 여백이 없는 경우 (1차 검수시)
  
### &nbsp;&nbsp; 중국인 생성 데이터 선별
- 1,2차 검수 처럼 일일이 한장한장 검수
  
### &nbsp;&nbsp; 구글 웹 페이지 말고 트위터나 인스타에서 이미지 크롤링 시도
- 인스타
    - 크롤링 코드 동작 할 때 마다 로그인을 해 줘야함 (자동화 가능)
    - 해쉬 태그 검색이기 때문에 원하는 이미지가 많이 나오지 않음
    - 일정 횟수 크롤링 시도시 차단되는 게 있어 만족스럽게 활용 불가
- 트위터
    - API 발급을 위해 개발자 계정으로 전환하는 과정 필요하여 시도 x
    - API키를 발급하지 않아도 할 수 있는 방법이 있었으나, 시간 부족으로 구현 x


<br/>


    
## **모델 학습**
### &nbsp;&nbsp; GCP 인스턴스 생성 및 사용
- 성돈님께 GCP에 로컬 파일 업로드 방법 강의 받음.
- 외부 ip 할당, 인스턴스 생성 등 연습.
  
### &nbsp;&nbsp; GCP로 StarGAN V2 모델 학습
- 수집한 이미지 + 중국인 생성 데이터 를 가지고 모델 학습
- 우선 300$ 무료 계정으로 연습 학습 후 GCP로 모델 학습
- GCP 가상환경 내 주피터 노트북 설치하여 파라미터 값, 경로 등 수정
### &nbsp;&nbsp; 모델 학습 결과
- 만번째 
    - 찌그러진 부분은 있으나 얼굴형과 헤어스타일 보존됨. 
    - 육안으로 봤을 때, 논문의 이미지 보다 더 잘 된것 같음.
- 3만번째
  - 레퍼런스를 잘 베끼는 모델같음. 
  - 원본 이미지를 바탕으로 레퍼런스 이미지의 화장을 가져와야하는데, 그대로 레퍼런스 이미지를 입힌 느낌이 강함.
  - 입력 이미지에 없던 귀걸이가 생성됨
 

<br/>


       
## **멘토링 3차시**
### &nbsp;&nbsp; 체크포인트 생성시 만들어지는 3개의 파일의 역할에 대해 질문
- `_optimis.ckpt , _ema.ckpt, .ckpt`
### &nbsp;&nbsp; StarGAN 모델 학습 결과 공유
- 데이터 약 1만장, 4만번에 약 17~18시간정도 소요되고있음.
- 우선 2만장 이상의 데이터가 필요할 것 같음.
- 하이퍼 파라미터가 어떤것이고 어떤 역할을 하는지에 대한 구분을 하는 것이 중요.
### &nbsp;&nbsp; 개발자 필수 툴
- **WANDB**
    - 모델 학습 시 필수 툴
    - 학습 진행도를 그래프로 확인 할 수 있어, 결과를 보고 학습을 중단할지, 진행할지 등을 시각화로 편하게 확인하고, 판단할 수 있음
- **Docker**
    - 컨테이너를 만들어, 프로젝트마다 필요한 가상환경을 구축할 수 있게 해주는 편리한 툴
      - 환경 충돌 방지
      - 가상환경을 지웠다 깔앗다 하는 번거로움 방지
    - 이미지를 구우면 다른 PC에서도 똑같은 가상환경, 프로그램 버전으로 모델을 학습시킬 수 있음
      - 회사에서도 생성한 모델의 이미지를 납품하는 식으로 사용함
  - 중간 중간에 다음 스텝으로 넘어갈때 날라가는 것을 clone을 만들어 방지할 수 있음.   
      - clone을 공유하면, 다른 컴퓨터에서도 똑같은 가상환경으로 모델을 학습시킬 수 있음

<br/>


      
## **닮은 꼴 연예인 찾기**
- landmark를 찍어서 점 사이의 기울기를 통해 값을 구했으나, 최대 최소값이 없기 때문에 정규화 과정을 해 주기 어려워, 3점을 이용해 각도를 구하는 방향으로 진행
- 산출한 값의 정규화를 어떻게 하면 좋을지 고민
    

<br/>



## **웹페이지**
- Heroku 를 이용해 Flask에서 만든 웹페이지를 서버에 올려 주소만 입력하면 들어갈 수 있게 함.
- but, 닮은꼴을 찾고 화장을 입혀주는 모델을 웹페이지에 올리는 방법은 좀 더 고민해 봐야함.